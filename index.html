<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IMPORTAÇÃO DE MOVIMENTO TOTVS RM - GRUPO NILTON LINS</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #003366;
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    header button {
      background: none;
      border: none;
      color: #FFD700;
      font-size: 1.5rem;
      cursor: pointer;
    }
    main {
      padding: 1rem;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border-radius: 5px;
      border: none;
    }
    button {
      background-color: #FFD700;
      color: #000;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }
    table {
      width: 100%;
      margin-top: 2rem;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #444;
      padding: 0.5rem;
      text-align: center;
    }
    footer {
      background-color: #003366;
      color: white;
      text-align: center;
      font-size: 0.75rem;
      padding: 1rem;
    }
    #modalAjuda {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: #222;
      padding: 2rem;
      border-radius: 8px;
      color: white;
      width: 80%;
      max-width: 500px;
      z-index: 10;
    }
    #modalAjuda h2 {
      margin-top: 0;
    }
    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9;
    }
  </style>
</head>
<body>
  <header>
    <h1>IMPORTAÇÃO DE MOVIMENTO TOTVS RM - GRUPO NILTON LINS</h1>
    <button onclick="abrirAjuda()">❓</button>
  </header>
  <main>
    <label for="chapa">CHAPA DO FUNCIONÁRIO:</label>
    <input id="chapa" maxlength="6" pattern="\\d{6}" required aria-required="true" />
    <label for="data">DATA DE PAGAMENTO:</label>
    <input id="data" type="date" required aria-required="true" />
    <label for="evento">CÓDIGO DO EVENTO:</label>
    <input id="evento" maxlength="4" required aria-required="true" />
    <label for="hora">HORA (HHH:MM):</label>
    <input id="hora" maxlength="6" oninput="formatarHora(this)" required aria-required="true" />
    <label for="referencia">REFERÊNCIA:</label>
    <input id="referencia" oninput="formatarValor(this)" />
    <label for="valor">VALOR:</label>
    <input id="valor" oninput="formatarValor(this)" required aria-required="true" />
    <label>VALOR ALTERADO MANUALMENTE:</label>
    <input type="checkbox" id="manual" />
    <button onclick="adicionarLinha()">Adicionar</button>
    <button onclick="exportar('txt')">Exportar TXT</button>
    <button onclick="exportar('csv')">Exportar CSV</button>
    <button onclick="exportar('xlsx')">Exportar Excel</button>
    <button onclick="excluirTudo()">Excluir Tudo</button>
    <table id="tabela">
      <thead>
        <tr>
          <th>CHAPA</th><th>DATA</th><th>EVENTO</th><th>HORA</th><th>REF</th><th>VALOR</th><th>VALOR ORIG</th><th>MARCAÇÃO</th><th>AÇÕES</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>
  <div id="overlay"></div>
  <div id="modalAjuda">
    <h2>Ajuda</h2>
    <p><strong>CHAPA:</strong> 6 dígitos obrigatórios.</p>
    <p><strong>DATA:</strong> Data de pagamento (formato brasileiro).</p>
    <p><strong>EVENTO:</strong> Código do evento com 4 caracteres.</p>
    <p><strong>HORA:</strong> Formato HHH:MM (ex: 135:00).</p>
    <p><strong>REFERÊNCIA, VALOR:</strong> Formato contábil (ex: 1.234,56).</p>
    <p><strong>VALOR ORIGINAL:</strong> Será preenchido igual ao VALOR.</p>
    <p><strong>MARCAÇÃO:</strong> S;N; se alterado manualmente, senão N;N;</p>
    <button onclick="fecharAjuda()">Fechar</button>
  </div>
  <footer>
    DIREITOS PRESERVADOS AO GRUPO NILTON LINS - UNIVERSIDADE NILTON LINS, Av Professor Nilton Lins, 3259 - Parque Laranjeiras, Flores - CEP: 69.058-040 - FONE: (92) 3643-2064 / 3643-2063 / 3643-2062 / 3643-2097 / 3643-2082 - WhatsApp: (92) 9 9190-3748
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    let dados = [];
    function formatarHora(input) {
      let valor = input.value.replace(/[^0-9]/g, '').padStart(5, '0');
      input.value = valor.length > 3 ? valor.slice(0, valor.length - 2) + ':' + valor.slice(-2) : valor;
    }
    function formatarValor(input) {
      let val = input.value.replace(/\D/g, '');
      if (val.length > 2) {
        let inteiro = val.slice(0, -2).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        let decimal = val.slice(-2);
        input.value = inteiro + ',' + decimal;
      } else input.value = val;
    }
    function adicionarLinha() {
      const chapa = document.getElementById('chapa').value;
      const data = document.getElementById('data').value.split('-').reverse().join('');
      const evento = document.getElementById('evento').value;
      const hora = document.getElementById('hora').value || '';
      const ref = document.getElementById('referencia').value || '';
      const val = document.getElementById('valor').value || '';
      if (!chapa || !data || !evento || !hora || !val) {
        alert("Por favor, preencha todos os campos obrigatórios.");
        return;
      }
      const manual = document.getElementById('manual').checked ? 'S;N;' : 'N;N;';
      const valorig = val;
      const linha = { chapa, data, evento, hora, ref, val, valorig, manual };
      dados.push(linha);
      atualizarTabela();
    }
    function atualizarTabela() {
      const tbody = document.querySelector('tbody');
      tbody.innerHTML = '';
      dados.forEach((d, i) => {
        tbody.innerHTML += `<tr><td>${d.chapa}</td><td>${d.data}</td><td>${d.evento}</td><td>${d.hora}</td><td>${d.ref}</td><td>${d.val}</td><td>${d.valorig}</td><td>${d.manual}</td><td><button onclick="editar(${i})">✏</button><button onclick="excluir(${i})">❌</button></td></tr>`;
      });
    }
    function excluir(i) {
      dados.splice(i, 1);
      atualizarTabela();
    }
    function editar(i) {
      const d = dados[i];
      document.getElementById('chapa').value = d.chapa;
      document.getElementById('data').value = `${d.data.slice(4, 8)}-${d.data.slice(2, 4)}-${d.data.slice(0, 2)}`;
      document.getElementById('evento').value = d.evento;
      document.getElementById('hora').value = d.hora;
      document.getElementById('referencia').value = d.ref;
      document.getElementById('valor').value = d.val;
      document.getElementById('manual').checked = d.manual === 'S;N;';
      excluir(i);
    }
    function excluirTudo() {
      dados = [];
      atualizarTabela();
    }
    function exportar(tipo) {
      let linhas = dados.map(d => `${d.chapa};${d.data};${d.evento};${d.hora};${d.ref};${d.val};${d.valorig};${d.manual}`);
      let conteudo = linhas.join('\n');
      if (tipo === 'xlsx') {
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet([
          ['CHAPA','DATA','EVENTO','HORA','REF','VALOR','VALOR ORIG','MARCAÇÃO'],
          ...dados.map(d => [d.chapa,d.data,d.evento,d.hora,d.ref,d.val,d.valorig,d.manual])
        ]);
        XLSX.utils.book_append_sheet(wb, ws, 'Exportação');
        XLSX.writeFile(wb, 'movimentos.xlsx');
      } else {
        const blob = new Blob([conteudo], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `movimentos.${tipo}`;
        link.click();
      }
    }
    function abrirAjuda() {
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('modalAjuda').style.display = 'block';
    }
    function fecharAjuda() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('modalAjuda').style.display = 'none';
    }
  </script>
</body>
</html>
